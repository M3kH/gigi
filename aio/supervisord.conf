[supervisord]
nodaemon=true
logfile=/var/log/gigi/supervisord.log
pidfile=/var/run/supervisord.pid

; ── Gitea (conditional — skipped if GITEA_URL is external) ────────────
[program:gitea]
command=/usr/local/bin/gitea web --config /data/gitea/conf/app.ini
user=gigi
autostart=false
autorestart=true
priority=100
stdout_logfile=/var/log/gigi/gitea.log
redirect_stderr=true
environment=GITEA_WORK_DIR="/data/gitea",HOME="/home/gigi",USER="gigi"

; ── Chrome stack (conditional — skipped if CHROME_CDP_URL is external) ─
[program:xvfb]
command=Xvfb :99 -screen 0 1920x1080x24 -ac
autostart=false
autorestart=true
priority=200

[program:chromium]
command=chromium --no-sandbox --disable-gpu --disable-dev-shm-usage
  --no-first-run --start-maximized --force-dark-mode
  --window-size=1920,1080 --window-position=0,0
  --display=:99
  --remote-debugging-port=9222
  --remote-allow-origins=*
  --user-data-dir=/data/chrome-profile
environment=DISPLAY=":99"
autostart=false
autorestart=true
priority=300
stdout_logfile=/var/log/gigi/chromium.log
redirect_stderr=true

[program:x11vnc]
command=x11vnc -display :99 -forever -nopw -shared -rfbport 5900 -xkb
autostart=false
autorestart=true
priority=400
stdout_logfile=/var/log/gigi/x11vnc.log
redirect_stderr=true

[program:websockify]
command=websockify --web=/usr/share/novnc 6080 localhost:5900
autostart=false
autorestart=true
priority=500
stdout_logfile=/var/log/gigi/websockify.log
redirect_stderr=true

[program:cdp-relay]
command=nginx -g "daemon off;"
autostart=false
autorestart=true
priority=600
user=root
stdout_logfile=/var/log/gigi/nginx-cdp.log
redirect_stderr=true

; ── Gigi (always starts) ──────────────────────────────────────────────
[program:gigi]
command=node --import tsx src/index.ts
directory=/app
user=gigi
autostart=false
autorestart=true
priority=900
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
redirect_stderr=true
environment=HOME="/home/gigi"
